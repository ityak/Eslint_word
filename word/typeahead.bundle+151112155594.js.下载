!function(){var _={isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(t){return!t||/^\s*$/.test(t)},escapeRegExChars:function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isArray:$.isArray,isFunction:$.isFunction,isObject:$.isPlainObject,isUndefined:function(t){return"undefined"==typeof t},bind:$.proxy,each:function(t,e){function n(t,n){return e(n,t)}$.each(t,n)},map:$.map,filter:$.grep,every:function(t,e){var n=!0;return t?($.each(t,function(i,r){return(n=e.call(null,r,i,t))?void 0:!1}),!!n):n},some:function(t,e){var n=!1;return t?($.each(t,function(i,r){return(n=e.call(null,r,i,t))?!1:void 0}),!!n):n},mixin:$.extend,getUniqueId:function(){var t=0;return function(){return t++}}(),templatify:function(t){function e(){return String(t)}return $.isFunction(t)?t:e},defer:function(t){setTimeout(t,0)},debounce:function(t,e,n){var i,r;return function(){var s,o,a=this,u=arguments;return s=function(){i=null,n||(r=t.apply(a,u))},o=n&&!i,clearTimeout(i),i=setTimeout(s,e),o&&(r=t.apply(a,u)),r}},throttle:function(t,e){var n,i,r,s,o,a;return o=0,a=function(){o=new Date,r=null,s=t.apply(n,i)},function(){var u=new Date,c=e-(u-o);return n=this,i=arguments,0>=c?(clearTimeout(r),r=null,o=u,s=t.apply(n,i)):r||(r=setTimeout(a,c)),s}},noop:function(){}},VERSION="0.10.2",tokenizers=function(t){function e(t){return t.split(/\s+/)}function n(t){return t.split(/\W+/)}function i(t){return function(e){return function(n){return t(n[e])}}}return{nonword:n,whitespace:e,obj:{nonword:i(n),whitespace:i(e)}}}(),LruCache=function(){function t(t){this.maxSize=t||100,this.size=0,this.hash={},this.list=new e}function e(){this.head=this.tail=null}function n(t,e){this.key=t,this.val=e,this.prev=this.next=null}return _.mixin(t.prototype,{set:function(t,e){var i,r=this.list.tail;this.size>=this.maxSize&&(this.list.remove(r),delete this.hash[r.key]),(i=this.hash[t])?(i.val=e,this.list.moveToFront(i)):(i=new n(t,e),this.list.add(i),this.hash[t]=i,this.size++)},get:function(t){var e=this.hash[t];return e?(this.list.moveToFront(e),e.val):void 0}}),_.mixin(e.prototype,{add:function(t){this.head&&(t.next=this.head,this.head.prev=t),this.head=t,this.tail=this.tail||t},remove:function(t){t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev},moveToFront:function(t){this.remove(t),this.add(t)}}),t}(),PersistentStorage=function(){function t(t){this.prefix=["__",t,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=new RegExp("^"+this.prefix)}function e(){return(new Date).getTime()}function n(t){return JSON.stringify(_.isUndefined(t)?null:t)}function i(t){return JSON.parse(t)}var r,s;try{r=window.localStorage,r.setItem("~~~","!"),r.removeItem("~~~")}catch(o){r=null}return s=r&&window.JSON?{_prefix:function(t){return this.prefix+t},_ttlKey:function(t){return this._prefix(t)+this.ttlKey},get:function(t){return this.isExpired(t)&&this.remove(t),i(r.getItem(this._prefix(t)))},set:function(t,i,s){return _.isNumber(s)?r.setItem(this._ttlKey(t),n(e()+s)):r.removeItem(this._ttlKey(t)),r.setItem(this._prefix(t),n(i))},remove:function(t){return r.removeItem(this._ttlKey(t)),r.removeItem(this._prefix(t)),this},clear:function(){var t,e,n=[],i=r.length;for(t=0;i>t;t++)(e=r.key(t)).match(this.keyMatcher)&&n.push(e.replace(this.keyMatcher,""));for(t=n.length;t--;)this.remove(n[t]);return this},isExpired:function(t){var n=i(r.getItem(this._ttlKey(t)));return _.isNumber(n)&&e()>n?!0:!1}}:{get:_.noop,set:_.noop,remove:_.noop,clear:_.noop,isExpired:_.noop},_.mixin(t.prototype,s),t}(),Transport=function(){function t(t){t=t||{},this._send=t.transport?e(t.transport):$.ajax,this._get=t.rateLimiter?t.rateLimiter(this._get):this._get}function e(t){return function(e,n){function i(t){_.defer(function(){s.resolve(t)})}function r(t){_.defer(function(){s.reject(t)})}var s=$.Deferred();return t(e,n,i,r),s}}var n=0,i={},r=6,s=new LruCache(10);return t.setMaxPendingRequests=function(t){r=t},t.resetCache=function(){s=new LruCache(10)},_.mixin(t.prototype,{_get:function(t,e,o){function a(e){o&&o(null,e),s.set(t,e)}function u(){o&&o(!0)}function c(){n--,delete i[t],l.onDeckRequestArgs&&(l._get.apply(l,l.onDeckRequestArgs),l.onDeckRequestArgs=null)}var h,l=this;(h=i[t])?h.done(a).fail(u):r>n?(n++,i[t]=this._send(t,e).done(a).fail(u).always(c)):this.onDeckRequestArgs=[].slice.call(arguments,0)},get:function(t,e,n){var i;return _.isFunction(e)&&(n=e,e={}),(i=s.get(t))?_.defer(function(){n&&n(null,i)}):this._get(t,e,n),!!i}}),t}(),SearchIndex=function(){function t(t){t=t||{},t.datumTokenizer&&t.queryTokenizer||$.error("datumTokenizer and queryTokenizer are both required"),this.datumTokenizer=t.datumTokenizer,this.queryTokenizer=t.queryTokenizer,this.reset()}function e(t){return t=_.filter(t,function(t){return!!t}),t=_.map(t,function(t){return t.toLowerCase()})}function n(t){for(var e={},n=[],i=0;i<t.length;i++)e[t[i]]||(e[t[i]]=!0,n.push(t[i]));return n}return _.mixin(t.prototype,{bootstrap:function(t){this.datums=t.datums},add:function(t){var e=this;t=_.isArray(t)?t:[t],_.each(t,function(t){var n;n=e.datums.push(t)-1,e.states.push(t.value)})},get:function(t){var i,r,s,o=this,a=[];return i=e(this.queryTokenizer(t)),s=_.escapeRegExChars(t),_.each(i,function(t){function e(t,e){for(var n=0;n<t.length;n++)if(t[n]==e)return!0;return!1}var n,i;if(r&&0===r.length)return!1;if(n=o.states,/^[\u4e00-\u9fa5]+$/i.test(s)){regex_a=new RegExp(" "+s+" ","i"),i=new RegExp(s,"i");for(var u=0;u<n.length&&a.length<5;u++)regex_a.test(n[u])&&(e(a,u)||a.push(u));for(var u=0;u<n.length&&a.length<5;u++)i.test(n[u])&&(e(a,u)||a.push(u))}else{regex_nick_a=new RegExp("^"+s+" ","i"),regex_pinyin_a=new RegExp(" "+s+" ","i"),regex_nick_f=new RegExp("^"+s+"[^ ]* ","i"),regex_pinyin_f=new RegExp(" "+s+"[^ ]* ","i"),regex_nick=new RegExp("^[^ ]*"+s+"[^ ]* ","i"),regex_pinyin=new RegExp(" [^ ]*"+s+"[^ ]* ","i");for(var u=0;u<n.length&&a.length<1;u++)regex_nick_a.test(n[u])&&(e(a,u)||a.push(u));for(var u=0;u<n.length&&a.length<5;u++)regex_pinyin_a.test(n[u])&&(e(a,u)||a.push(u));for(var u=0;u<n.length&&a.length<5;u++)regex_nick_f.test(n[u])&&(e(a,u)||a.push(u));for(var u=0;u<n.length&&a.length<5;u++)regex_nick.test(n[u])&&(e(a,u)||a.push(u));for(var u=0;u<n.length&&a.length<5;u++)regex_pinyin_f.test(n[u])&&(e(a,u)||a.push(u));for(var u=0;u<n.length&&a.length<5;u++)regex_pinyin.test(n[u])&&(e(a,u)||a.push(u))}}),r=a,r?_.map(n(r),function(t){return o.datums[t]}):[]},reset:function(){this.datums=[],this.states=[]},serialize:function(){return{datums:this.datums}}}),t}(),oParser=function(){function t(t){return t.local||null}function e(t){var e,n;return n={url:null,thumbprint:"",ttl:864e5,filter:null,ajax:{}},(e=t.prefetch||null)&&(e=_.isString(e)?{url:e}:e,e=_.mixin(n,e),e.thumbprint=VERSION+e.thumbprint,e.ajax.type=e.ajax.type||"GET",e.ajax.dataType=e.ajax.dataType||"json",!e.url&&$.error("prefetch requires url to be set")),e}function n(t){function e(t){return function(e){return _.debounce(e,t)}}function n(t){return function(e){return _.throttle(e,t)}}var i,r;return r={url:null,wildcard:"%QUERY",replace:null,rateLimitBy:"debounce",rateLimitWait:300,send:null,filter:null,ajax:{}},(i=t.remote||null)&&(i=_.isString(i)?{url:i}:i,i=_.mixin(r,i),i.rateLimiter=/^throttle$/i.test(i.rateLimitBy)?n(i.rateLimitWait):e(i.rateLimitWait),i.ajax.type=i.ajax.type||"GET",i.ajax.dataType=i.ajax.dataType||"json",delete i.rateLimitBy,delete i.rateLimitWait,!i.url&&$.error("remote requires url to be set")),i}return{local:t,prefetch:e,remote:n}}();!function(t){function e(t){t&&(t.local||t.prefetch||t.remote)||$.error("one of local, prefetch, or remote is required"),this.limit=t.limit||5,this.sorter=n(t.sorter),this.dupDetector=t.dupDetector||i,this.local=oParser.local(t),this.prefetch=oParser.prefetch(t),this.remote=oParser.remote(t),this.cacheKey=this.prefetch?this.prefetch.cacheKey||this.prefetch.url:null,this.index=new SearchIndex({datumTokenizer:t.datumTokenizer,queryTokenizer:t.queryTokenizer}),this.storage=this.cacheKey?new PersistentStorage(this.cacheKey):null}function n(t){function e(e){return e.sort(t)}function n(t){return t}return _.isFunction(t)?e:n}function i(){return!1}var r,s;return r=t.Bloodhound,s={data:"data",protocol:"protocol",thumbprint:"thumbprint"},t.Bloodhound=e,e.noConflict=function(){return t.Bloodhound=r,e},e.tokenizers=tokenizers,_.mixin(e.prototype,{_loadPrefetch:function(t){function e(e){r.clear(),r.add(t.filter?t.filter(e):e),r._saveToStorage(r.index.serialize(),t.thumbprint,t.ttl)}var n,i,r=this;return(n=this._readFromStorage(t.thumbprint))?(this.index.bootstrap(n),i=$.Deferred().resolve()):i=$.ajax(t.url,t.ajax).done(e),i},_getFromRemote:function(t,e){function n(t,n){e(t?[]:s.remote.filter?s.remote.filter(n):n)}var i,r,s=this;return t=t||"",r=encodeURIComponent(t),i=this.remote.replace?this.remote.replace(this.remote.url,t):this.remote.url.replace(this.remote.wildcard,r),this.transport.get(i,this.remote.ajax,n)},_saveToStorage:function(t,e,n){this.storage&&(this.storage.set(s.data,t,n),this.storage.set(s.protocol,location.protocol,n),this.storage.set(s.thumbprint,e,n))},_readFromStorage:function(t){var e,n={};return this.storage&&(n.data=this.storage.get(s.data),n.protocol=this.storage.get(s.protocol),n.thumbprint=this.storage.get(s.thumbprint)),e=n.thumbprint!==t||n.protocol!==location.protocol,n.data&&!e?n.data:null},_initialize:function(){function t(){n.add(_.isFunction(i)?i():i)}var e,n=this,i=this.local;return e=this.prefetch?this._loadPrefetch(this.prefetch):$.Deferred().resolve(),i&&e.done(t),this.transport=this.remote?new Transport(this.remote):null,this.initPromise=e.promise()},initialize:function(t){return!this.initPromise||t?this._initialize():this.initPromise},add:function(t){this.index.add(t)},get:function(t,e){function n(t){var n=r.slice(0);_.each(t,function(t){var e;return e=_.some(n,function(e){return i.dupDetector(t,e)}),!e&&n.push(t),n.length<i.limit}),e&&e(i.sorter(n))}var i=this,r=[],s=!1;return r=this.index.get(t),r=this.sorter(r).slice(0,this.limit),r.length<this.limit&&this.transport&&(s=this._getFromRemote(t,n)),s||(r.length>0||!this.transport)&&e&&e(r),r},clear:function(){this.index.reset()},clearPrefetchCache:function(){this.storage&&this.storage.clear()},clearRemoteCache:function(){this.transport&&Transport.resetCache()},ttAdapter:function(){return _.bind(this.get,this)}}),e}(this);var html={wrapper:'<span class="twitter-typeahead"></span>',dropdown:'<span class="tt-dropdown-menu"></span>',dataset:'<div class="tt-dataset-%CLASS%"></div>',suggestions:'<span class="tt-suggestions"></span>',suggestion:'<div class="tt-suggestion"></div>'},css={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none"},input:{position:"relative",verticalAlign:"top"},inputWithNoHint:{position:"relative",verticalAlign:"top"},dropdown:{position:"absolute",top:"100%",left:"0",zIndex:"1200",display:"none"},suggestions:{display:"block"},suggestion:{whiteSpace:"nowrap",cursor:"pointer"},suggestionChild:{whiteSpace:"nowrap"},ltr:{left:"0",right:"auto"},rtl:{left:"auto",right:" 0"}};_.isMsie()&&_.mixin(css.input,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"}),_.isMsie()&&_.isMsie()<=7&&_.mixin(css.input,{marginTop:"-1px"});var EventBus=function(){function t(t){t&&t.el||$.error("EventBus initialized without el"),this.$el=$(t.el)}var e="typeahead:";return _.mixin(t.prototype,{trigger:function(t){var n=[].slice.call(arguments,1);this.$el.trigger(e+t,n)}}),t}(),EventEmitter=function(){function t(t,e,n,i){var r;if(!n)return this;for(e=e.split(u),n=i?a(n,i):n,this._callbacks=this._callbacks||{};r=e.shift();)this._callbacks[r]=this._callbacks[r]||{sync:[],async:[]},this._callbacks[r][t].push(n);return this}function e(e,n,i){return t.call(this,"async",e,n,i)}function n(e,n,i){return t.call(this,"sync",e,n,i)}function i(t){var e;if(!this._callbacks)return this;for(t=t.split(u);e=t.shift();)delete this._callbacks[e];return this}function r(t){var e,n,i,r,o;if(!this._callbacks)return this;for(t=t.split(u),i=[].slice.call(arguments,1);(e=t.shift())&&(n=this._callbacks[e]);)r=s(n.sync,this,[e].concat(i)),o=s(n.async,this,[e].concat(i)),r()&&c(o);return this}function s(t,e,n){function i(){for(var i,r=0;!i&&r<t.length;r+=1)i=t[r].apply(e,n)===!1;return!i}return i}function o(){var t;return t=window.setImmediate?function(t){setImmediate(function(){t()})}:function(t){setTimeout(function(){t()},0)}}function a(t,e){return t.bind?t.bind(e):function(){t.apply(e,[].slice.call(arguments,0))}}var u=/\s+/,c=o();return{onSync:n,onAsync:e,off:i,trigger:r}}(),highlight=function(t){function e(t,e,n){for(var i,r=[],s=0;s<t.length;s++)r.push(_.escapeRegExChars(t[s]));return i=n?"\\b("+r.join("|")+")\\b":"("+r.join("|")+")",e?new RegExp(i):new RegExp(i,"i")}var n={node:null,pattern:null,tagName:"strong",className:null,wordsOnly:!1,caseSensitive:!1};return function(i){function r(e){var n,r;return(n=o.exec(e.data))&&(wrapperNode=t.createElement(i.tagName),i.className&&(wrapperNode.className=i.className),r=e.splitText(n.index),r.splitText(n[0].length),wrapperNode.appendChild(r.cloneNode(!0)),e.parentNode.replaceChild(wrapperNode,r)),!!n}function s(t,e){for(var n,i=3,r=0;r<t.childNodes.length;r++)n=t.childNodes[r],n.nodeType===i?r+=e(n)?1:0:s(n,e)}var o;i=_.mixin({},n,i),i.node&&i.pattern&&(i.pattern=_.isArray(i.pattern)?i.pattern:[i.pattern],o=e(i.pattern,i.caseSensitive,i.wordsOnly),s(i.node,r))}}(window.document),Input=function(){function Input(t){var e,n,i,r,s=this;t=t||{},t.input||$.error("input is missing"),e=_.bind(this._onBlur,this),n=_.bind(this._onFocus,this),i=_.bind(this._onKeydown,this),r=_.bind(this._onInput,this),this.$hint=$(t.hint),this.$input=$(t.input).on("blur.tt",e).on("focus.tt",n).on("keydown.tt",i),0===this.$hint.length&&(this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=_.noop),_.isMsie()?this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(t){specialKeyCodeMap[t.which||t.keyCode]||_.defer(_.bind(s._onInput,s,t))}):this.$input.on("input.tt",r),this.query=this.$input.val(),this.$overflowHelper=buildOverflowHelper(this.$input)}function buildOverflowHelper(t){return $('<pre aria-hidden="true"></pre>').css({position:"absolute",display:"none",visibility:"hidden",whiteSpace:"pre",fontFamily:t.css("font-family"),fontSize:t.css("font-size"),fontStyle:t.css("font-style"),fontVariant:t.css("font-variant"),fontWeight:t.css("font-weight"),wordSpacing:t.css("word-spacing"),letterSpacing:t.css("letter-spacing"),textIndent:t.css("text-indent"),textRendering:t.css("text-rendering"),textTransform:t.css("text-transform")}).insertAfter(t)}function areQueriesEquivalent(t,e){return Input.normalizeQuery(t)===Input.normalizeQuery(e)}function withModifier(t){return t.altKey||t.ctrlKey||t.metaKey||t.shiftKey}var originValue="",specialKeyCodeMap;return specialKeyCodeMap={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down",8:"backspace",46:"delete",17:"ctrl",91:"command"},Input.normalizeQuery=function(t){return(t||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ")},Input.getCaretStart=function(t){if("undefined"!=typeof t.selectionStart)return t.selectionStart;if(document.selection&&document.selection.createRange){var e=document.selection.createRange();try{var n=e.duplicate();n.moveToElementText(t)}catch(i){try{var n=t.createTextRange()}catch(i){return}}try{n.setEndPoint("EndToStart",e)}catch(i){return}var r=n.text.length;return r>t.value.length?-1:r}},Input.getCaretEnd=function(t){if("undefined"!=typeof t.selectionEnd)return t.selectionEnd;if(document.selection&&document.selection.createRange){var e=document.selection.createRange();try{var n=e.duplicate();n.moveToElementText(t)}catch(i){try{var n=t.createTextRange()}catch(i){return}}try{n.setEndPoint("EndToEnd",e)}catch(i){return}var r=n.text.length;return r>t.value.length?-1:r}},Input.setCaret=function(t,e){t.setSelectionRange?t.setSelectionRange(e,e):t.createTextRange&&(m=t.createTextRange(),m.collapse(!0),m.moveStart("character",e),m.moveEnd("character",e),m.select())},_.mixin(Input.prototype,EventEmitter,{_onBlur:function(){var t=(this.getQuery(),this.getHint());t.replace(";","");var e=this.getInputValue();(t!=e&&""!==t||""===e)&&this.setQuery(""),this.trigger("blurred")},_onFocus:function(){this.trigger("focused")},_onKeydown:function(t){var e=specialKeyCodeMap[t.which||t.keyCode],n=Input.prototype._getSeletionReg(t.currentTarget);target=t.currentTarget,values=target.value,0==n||t.ctrlKey||t.metaKey||void 0!=e||$(target).val(values.replace(n,"")),this._managePreventDefault(e,t),e&&this._shouldTrigger(e,t)&&this.trigger(e+"Keyed",t)},_onInput:function(){this._checkInputValue()},_getSeletionReg:function(target){var text="",textStr;text=window.getSelection?target.value.substring(target.selectionStart,target.selectionEnd):document.selection.createRange().text,textStr=text,";"==textStr[0]&&(textStr=textStr.substr(1)),";"==textStr[textStr.length-1]&&(textStr=textStr.substr(0,textStr.length-1)),textStr=textStr.replace(/\(/g,"\\("),textStr=textStr.replace(/\)/g,"\\)");var reg=new RegExp(eval("/[^;]*?"+textStr+".*?(;|$)/"));return""==textStr?!1:reg},_managePreventDefault:function(t,e){var n,i,r,s=Input.getCaretStart(e.currentTarget),o=Input.getCaretEnd(e.currentTarget),a=s>o?s:o;if(!(67==e.keyCode&&e.ctrlKey||86==e.keyCode&&e.ctrlKey)){if(67==e.keyCode&&e.metaKey)return!1;if(86!=e.keyCode||!e.metaKey){switch(t){case"tab":i=this.getHint(),r=this.getInputValue(),n=i&&i!==r&&!withModifier(e);break;case"left":h=e.currentTarget,p=$(h).val(),substr=p.substring(0,a),c=substr.lastIndexOf(";"),substr.length-1==c&&(c=substr.substring(0,substr.length-1).lastIndexOf(";")),Input.setCaret(h,c+2);break;case"right":h=e.currentTarget,p=$(h).val(),";"!=p[p.length-1]&&(p+=";"),substr=p.substring(a+2,p.length),c=substr.indexOf(";"),Input.setCaret(h,a+c+2);break;case"up":case"down":n=!withModifier(e);break;case"enter":var u=this.getHint();if("undefined"!=typeof u&&""!=u){var c=Input.getCaretStart(e.target);is_need_add=";"!==e.target.value.substring(c,c+1),input_value=is_need_add?u+";":u,this.setInputValue(input_value)}else if(""!=this.getInputValue()){var c=Input.getCaretStart(e.target);is_need_add=";"!==e.target.value.substring(c,c+1),input_value=is_need_add?this.getInputValue()+";":this.getInputValue(),this.setInputValue(input_value)}n=!1;break;case"delete":var h=e.currentTarget,l=Input.prototype._getSeletionReg(h),p=h.value;0!=l&&($(h).val(p.replace(l,"")),e.preventDefault());break;case"backspace":var h=e.currentTarget,l=Input.prototype._getSeletionReg(h),p=h.value;if(0!=l)$(h).val(p.replace(l,"")),e.preventDefault();else if(";"==p.substring(a-1,a)||";"==p[a-1])return substr=p.substring(0,a),c=substr.lastIndexOf(";"),substr.length-1==c&&(c=substr.substring(0,substr.length-1).lastIndexOf(";")),vals=p.substring(0,c+2),values_current=p.substring(a,p.length),$(h).val(vals+values_current),Input.setCaret(h,c+2),!1;e.stopPropagation();break;case"delete":return e.preventDefault(),!1;case"command":case"ctrl":return!1;default:h=e.currentTarget,p=h.value,jQuery.browser.msie?";"!==p.substring(a,a+1)&&a!=p.length&&(p=p.substring(0,a)+";"+p.substring(a,p.length),h.value=p):";"!==p[a]&&a!=p.length&&(p=p.substring(0,a)+";"+p.substring(a,p.length),$(h).val(p)),Input.setCaret(h,a),n=!1}n&&e.preventDefault()}}},_shouldTrigger:function(t,e){var n;switch(t){case"tab":n=!withModifier(e);break;default:n=!0}return n},_checkInputValue:function(){var t,e,n;t=this.getInputValue(),e=areQueriesEquivalent(t,this.query),n=e?this.query.length!==t.length:!1,e?n&&this.trigger("whitespaceChanged",this.query):this.trigger("queryChanged",this.query=t)},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query},setQuery:function(t){this.query=t},getInputValue:function(){this.$input.originValue=this.$input.val();var t=Input.getCaretStart(this.$input[0]),e=this.$input[0].value,n=e.substring(0,t);return n=-1==n.indexOf(";")?n.substring(0,n.length):n.substring(n.lastIndexOf(";")+1,n.length)},setInputValue:function(t,e){if(this.$input.val().length>0)var n=Input.getCaretStart(this.$input[0]),i=this.$input[0].value,r=i.substring(0,n),s=i.substring(n,i.length),r=-1==r.indexOf(";")?"":r.substring(0,r.lastIndexOf(";")+1),s=/^;/.test(s)?s:"",t=r+t+s;this.$input.val(t),e?this.clearHint():this._checkInputValue()},resetInputValue:function(){this.setInputValue(this.query,!0)},getHint:function(){return this.$hint.val()},setHint:function(t){this.$hint.val(t)},clearHint:function(){this.setHint("")},clearHintIfInvalid:function(){var t,e,n,i;t=this.getInputValue(),e=this.getHint(),n=t!==e&&0===e.indexOf(t),i=""!==t&&n&&!this.hasOverflow(),!i&&this.clearHint()},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},hasOverflow:function(){var t=this.$input.width()-2;return this.$overflowHelper.text(this.getInputValue()),this.$overflowHelper.width()>=t},isCursorAtEnd:function(){var t,e,n;return t=this.$input.val().length,e=this.$input[0].selectionStart,_.isNumber(e)?e===t:document.selection?(n=document.selection.createRange(),n.moveStart("character",-t),t===n.text.length):!0},destroy:function(){this.$hint.off(".tt"),this.$input.off(".tt"),this.$hint=this.$input=this.$overflowHelper=null}}),Input}(),Dataset=function(){function t(t){t=t||{},t.templates=t.templates||{},t.source||$.error("missing source"),t.name&&!i(t.name)&&$.error("invalid dataset name: "+t.name),this.query=null,this.highlight=!!t.highlight,this.name=t.name||_.getUniqueId(),this.source=t.source,this.displayFn=e(t.display||t.displayKey),this.templates=n(t.templates,this.displayFn),this.$el=$(html.dataset.replace("%CLASS%",this.name))}function e(t){function e(e){return e[t]}return t=t||"value",_.isFunction(t)?t:e}function n(t,e){function n(t){return"<p><img class='hidden-avatar-default'/>"+e(t)+"</p>"}return{empty:t.empty&&_.templatify(t.empty),header:t.header&&_.templatify(t.header),footer:t.footer&&_.templatify(t.footer),suggestion:t.suggestion||n}}function i(t){return/^[_a-zA-Z0-9-]+$/.test(t)}var r="ttDataset",s="ttValue",o="ttDatum";return t.extractDatasetName=function(t){return $(t).data(r)},t.extractValue=function(t){return $(t).data(s)},t.extractDatum=function(t){return $(t).data(o)},_.mixin(t.prototype,EventEmitter,{_render:function(t,e){function n(){return l.templates.empty({query:t,isEmpty:!0})}function i(){function n(t){var e;return e=$(html.suggestion).append(l.templates.suggestion(t)).data(r,l.name).data(s,l.displayFn(t)).data(o,t),e.children().each(function(){$(this).css(css.suggestionChild)}),e}var i,a;return i=$(html.suggestions).css(css.suggestions),a=_.map(e,n),i.append.apply(i,a),l.highlight&&highlight({node:i[0],pattern:t}),i}function a(){return l.templates.header({query:t,isEmpty:!c})}function u(){return l.templates.footer({query:t,isEmpty:!c})}if(this.$el){var c,h,l=this;this.$el.empty(),c=e&&e.length,!c&&this.templates.empty?this.$el.html(n()).prepend(l.templates.header?a():null).append(l.templates.footer?u():null):c&&(h=i(),this.$el.html(h).prepend(l.templates.header?a():null).append(l.templates.footer?u():null),Dropdown.prototype._setCursor(h.find(".tt-suggestion"))),this.trigger("rendered")}},getRoot:function(){return this.$el},update:function(t){function e(e){n.canceled||t!==n.query||n._render(t,e)}var n=this;this.query=t,this.canceled=!1,this.source(t,e)},cancel:function(){this.canceled=!0},clear:function(){this.cancel(),this.$el.empty(),this.trigger("rendered")},isEmpty:function(){return this.$el.is(":empty")},destroy:function(){this.$el=null}}),t}(),Dropdown=function(){function Dropdown(t){var e,n,i,r=this;t=t||{},t.menu||$.error("menu is required"),this.isOpen=!1,this.isEmpty=!0,this.datasets=_.map(t.datasets,initializeDataset),this.input=t.input,e=_.bind(this._onSuggestionClick,this),n=_.bind(this._onSuggestionMouseEnter,this),i=_.bind(this._onSuggestionMouseLeave,this),this.$menu=$(t.menu).on("click.tt",".tt-suggestion",e).on("mouseenter.tt",".tt-suggestion",n).on("mouseleave.tt",".tt-suggestion",i),_.each(this.datasets,function(t){r.$menu.append(t.getRoot()),t.onSync("rendered",r._onRendered,r)})}function initializeDataset(t){return new Dataset(t)}return _.mixin(Dropdown.prototype,EventEmitter,{_onSuggestionClick:function(t){this.trigger("suggestionClicked",$(t.currentTarget))},_onSuggestionMouseEnter:function(t){this._removeCursor(),this._setCursor($(t.currentTarget),!0)},_onSuggestionMouseLeave:function(){this._removeCursor()},_onRendered:function(){function t(t){return t.isEmpty()}this.isEmpty=_.every(this.datasets,t),this.isEmpty?this._hide():this.isOpen&&this._show(),this.trigger("datasetRendered")},_hide:function(){this.$menu.hide()},_show:function(){this._addAvatar(),this.$menu.css("display","block")},_getSuggestions:function(){return this.$menu.find(".tt-suggestion")},_getCursor:function(){return this.$menu.find(".tt-cursor").first()},_setCursor:function(t,e){t.first().addClass("tt-cursor"),!e&&this.trigger("cursorMoved")},_removeCursor:function(){this._getCursor().removeClass("tt-cursor")},_moveCursor:function(t){var e,n,i,r;if(this.isOpen){if(n=this._getCursor(),e=this._getSuggestions(),this._removeCursor(),i=e.index(n)+t,i=(i+1)%(e.length+1)-1,-1===i)return void this.trigger("cursorRemoved");-1>i&&(i=e.length-1),this._setCursor(r=e.eq(i)),this._ensureVisible(r)}},_ensureVisible:function(t){var e,n,i,r;e=t.position().top,n=e+t.outerHeight(!0),i=this.$menu.scrollTop(),r=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10),0>e?this.$menu.scrollTop(i+e):n>r&&this.$menu.scrollTop(i+(n-r))},_addAvatar:function addAvatar(){var that=this,$menu=this.$menu,$input=this.input;if($menu){var $suggestions=$menu.find(".tt-suggestion"),dataSrcParam=$input.data("srcParam"),users=eval("window."+TFL.pinyinuserchooser.getVarName($input)),workspaceID=TFL.pinyinuserchooser.getWorkspaceID($input);("undefined"==typeof window._newarruserspinyin||dataSrcParam&&"1"==TFL.getQueryValue("disabled",dataSrcParam))&&TFL.pinyinuserchooser.getIdNickMap(users),"undefined"!=typeof TFL&&TFL.pinyinuserchooser.avatar&&_.each($suggestions,function(t){var e=$(t).find("p"),n=e.text(),i=n,r="",s=-1!==i.indexOf("(")?i.indexOf("("):-1!==i.indexOf("（")?i.indexOf("（"):-1;i=0>s?i:i.substring(0,s),"undefined"!=typeof window._newarruserspinyin&&i in window._newarruserspinyin?r=window._newarruserspinyin[i][3]:(TFL.pinyinuserchooser.getIdNickMap(users),"undefined"!=typeof window._newarruserspinyin&&i in window._newarruserspinyin&&(r=window._newarruserspinyin[i][3])),e.on("cloudAvatarImg.loaded",function(t,e,n){return void 0!=n&&$(this).find("img").length>0?void $(this).find("img").attr("src",n).removeClass("hidden-avatar-default"):($(this).find("img").remove(),void $(this).prepend(e))}),TFL.pinyinuserchooser.avatar.getAvatar(r,n,workspaceID,e)})}},_delayAvatar:function(t){setTimeout(function(){var e=t.getAttribute("data-src");e&&$(t).is(":visible")&&(t.src=e,t.removeAttribute("data-src"))},150)},close:function(){this.isOpen&&(this.isOpen=!1,this._removeCursor(),this._hide(),this.trigger("closed"))},open:function(){this.isOpen||(this.isOpen=!0,!this.isEmpty&&this._show(),this.trigger("opened"))},setLanguageDirection:function(t){this.$menu.css("ltr"===t?css.ltr:css.rtl)},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},getDatumForSuggestion:function(t){var e=null;return t.length&&(e={raw:Dataset.extractDatum(t),value:Dataset.extractValue(t),datasetName:Dataset.extractDatasetName(t)}),e},getDatumForCursor:function(){return this.getDatumForSuggestion(this._getCursor().first())},getDatumForTopSuggestion:function(){return this.getDatumForSuggestion(this._getSuggestions().first())},update:function(t){function e(e){e.update(t)}_.each(this.datasets,e)},empty:function(){function t(t){t.clear()}_.each(this.datasets,t),this.isEmpty=!0},isVisible:function(){return this.isOpen&&!this.isEmpty},destroy:function(){function t(t){t.destroy()}this.$menu.off(".tt"),this.$menu=null,_.each(this.datasets,t)}}),Dropdown}(),Typeahead=function(){function t(t){var n,i,r;t=t||{},t.input||$.error("missing input"),this.isActivated=!1,this.autoselect=!!t.autoselect,this.minLength=_.isNumber(t.minLength)?t.minLength:1,this.$node=e(t.input,t.withHint),n=$(".tt-dropdown-menu").last(),i=this.$node.find(".tt-input"),r=this.$node.find(".tt-hint"),i.on("blur.tt",function(t){$(this).val($(this).val().replace(/\s/g,""));var e,r,s;e=document.activeElement,r=n.is(e),s=n.has(e).length>0,_.isMsie()&&(r||s)&&(t.preventDefault(),t.stopImmediatePropagation(),_.defer(function(){i.data("ieTypeaheadFocus",1),i.trigger("focus")}))}),n.on("mousedown.tt",function(t){t.preventDefault()}),this.eventBus=t.eventBus||new EventBus({el:i}),this.dropdown=new Dropdown({menu:n,datasets:t.datasets,input:i}).onSync("suggestionClicked",this._onSuggestionClicked,this).onSync("cursorMoved",this._onCursorMoved,this).onSync("cursorRemoved",this._onCursorRemoved,this).onSync("opened",this._onOpened,this).onSync("closed",this._onClosed,this).onAsync("datasetRendered",this._onDatasetRendered,this),this.input=new Input({input:i,hint:r}).onSync("focused",this._onFocused,this).onSync("blurred",this._onBlurred,this).onSync("enterKeyed",this._onEnterKeyed,this).onSync("tabKeyed",this._onTabKeyed,this).onSync("escKeyed",this._onEscKeyed,this).onSync("upKeyed",this._onUpKeyed,this).onSync("downKeyed",this._onDownKeyed,this).onSync("leftKeyed",this._onLeftKeyed,this).onSync("rightKeyed",this._onRightKeyed,this).onSync("queryChanged",this._onQueryChanged,this).onSync("whitespaceChanged",this._onWhitespaceChanged,this),this._setLanguageDirection()}function e(t,e){var i,s,o,a;i=$(t),s=$(html.wrapper).css(css.wrapper),o=$(html.dropdown).css({position:"absolute",left:i.offset().left,top:i.offset().top+i.outerHeight(),zIndex:1200}),a=i.clone().css(css.hint).css(n(i)),a.val("").removeData().addClass("tt-hint").removeAttr("id name placeholder required").prop("disabled",!0).attr({autocomplete:"off",spellcheck:"false",type:"hidden"}),i.data(r,{dir:i.attr("dir"),autocomplete:i.attr("autocomplete"),spellcheck:i.attr("spellcheck"),style:i.attr("style")}),i.addClass("tt-input").attr({autocomplete:"off",spellcheck:!1}).css(e?css.input:css.inputWithNoHint),i.mouseup(function(t){if(o.css({left:$(this).offset().left,top:$(this).offset().top+i.outerHeight()}),caret_pos_start=Input.getCaretStart(t.target),caret_pos_end=Input.getCaretEnd(t.target),caret_pos_start>=0&&caret_pos_end==caret_pos_start){values=t.target.value;var e=values.substring(0,caret_pos_start),n=values.substring(caret_pos_start+1,values.length),r=e.length-e.lastIndexOf(";"),s=n.indexOf(";")+1;s>r?Input.setCaret(t.target,e.lastIndexOf(";")+1):Input.setCaret(t.target,caret_pos_start+s+1)}}).keyup(function(t){var e=$(this);setTimeout(function(){var t=e.offset().top+i.outerHeight();e.offset().top+i.outerHeight()+o.height()>=$(document).height()&&o.height()<e.offset().top&&(t=e.offset().top-o.height()),o.css({top:t})},500)});try{!i.attr("dir")&&i.attr("dir","auto")}catch(u){}return $("body").append(o),i.wrap(s).parent().prepend(e?a:null)}function n(t){return{backgroundAttachment:t.css("background-attachment"),backgroundClip:t.css("background-clip"),backgroundColor:t.css("background-color"),backgroundImage:t.css("background-image"),backgroundOrigin:t.css("background-origin"),backgroundPosition:t.css("background-position"),backgroundRepeat:t.css("background-repeat"),backgroundSize:t.css("background-size")}}function i(t){var e=t.find(".tt-input");_.each(e.data(r),function(t,n){_.isUndefined(t)?e.removeAttr(n):e.attr(n,t)}),e.detach().removeData(r).removeClass("tt-input").insertAfter(t),t.remove()}var r="ttAttrs";return _.mixin(t.prototype,{_onSuggestionClicked:function(t,e){
var n;(n=this.dropdown.getDatumForSuggestion(e))&&this._select(n)},_onCursorMoved:function(){var t=this.dropdown.getDatumForCursor();this.input.setInputValue(t.value,!0),this.eventBus.trigger("cursorchanged",t.raw,t.datasetName)},_onCursorRemoved:function(){this.input.resetInputValue(),this._updateHint()},_onDatasetRendered:function(){this._updateHint()},_onOpened:function(){this._updateHint(),this.eventBus.trigger("opened")},_onClosed:function(){this.input.clearHint(),this.eventBus.trigger("closed")},_onFocused:function(){this.isActivated=!0,this.dropdown.open()},_onBlurred:function(){this.isActivated=!1,this.dropdown.empty(),this.dropdown.close(),this.eventBus.$el.trigger("blurred")},_onEnterKeyed:function(t,e){var n,i;n=this.dropdown.getDatumForCursor(),i=this.dropdown.getDatumForTopSuggestion(),n?(this._select(n),e.preventDefault()):this.autoselect&&i&&(this._select(i),e.preventDefault()),this._onBlurred()},_onTabKeyed:function(t,e){var n;(n=this.dropdown.getDatumForCursor())?(this._select(n),e.preventDefault()):this._autocomplete(!0)},_onEscKeyed:function(){this.dropdown.close(),this.input.resetInputValue()},_onUpKeyed:function(){var t=this.input.getQuery();this.dropdown.isEmpty&&t.length>=this.minLength?this.dropdown.update(t):this.dropdown.moveCursorUp(),this.dropdown.open()},_onDownKeyed:function(){var t=this.input.getQuery();this.dropdown.isEmpty&&t.length>=this.minLength?this.dropdown.update(t):this.dropdown.moveCursorDown(),this.dropdown.open()},_onLeftKeyed:function(){"rtl"===this.dir&&this._autocomplete()},_onRightKeyed:function(){"ltr"===this.dir&&this._autocomplete()},_onQueryChanged:function(t,e){this.input.clearHintIfInvalid(),e.length>=this.minLength?this.dropdown.update(e):this.dropdown.empty(),this.dropdown.open(),this._setLanguageDirection()},_onWhitespaceChanged:function(){this._updateHint(),this.dropdown.open()},_setLanguageDirection:function(){var t;this.dir!==(t=this.input.getLanguageDirection())&&(this.dir=t,this.$node.css("direction",t))},_updateHint:function(){var t,e,n,i,r,s;t=this.dropdown.getDatumForTopSuggestion(),t&&this.dropdown.isVisible()&&!this.input.hasOverflow()?(values=this.input.getInputValue(),values=values.split(";"),e=values.pop(),n=Input.normalizeQuery(e),i=_.escapeRegExChars(n),r=new RegExp("(?:"+i+")(.+$)","i"),s=r.exec(t.value),s?this.input.setHint(t.value):this.input.clearHint()):this.input.clearHint()},_autocomplete:function(t){var e,n,i,r;e=this.input.getHint(),n=this.input.getQuery(),i=t||this.input.isCursorAtEnd(),e&&n!==e&&i&&(r=this.dropdown.getDatumForTopSuggestion(),r&&this.input.setInputValue(r.value),this.eventBus.trigger("autocompleted",r.raw,r.datasetName))},_select:function(t){this.input.setQuery(t.value),this.input.setInputValue(t.value,!0),this._setLanguageDirection(),this.eventBus.trigger("selected",t.raw,t.datasetName),this.dropdown.close(),_.defer(_.bind(this.dropdown.empty,this.dropdown))},open:function(){this.dropdown.open()},close:function(){this.dropdown.close()},setVal:function(t){this.isActivated?this.input.setInputValue(t):(this.input.setQuery(t),this.input.setInputValue(t,!0)),this._setLanguageDirection()},getVal:function(){return this.input.getQuery()},destroy:function(){this.input.destroy(),this.dropdown.destroy(),i(this.$node),this.$node=null}}),t}();!function(){var t,e,n;t=$.fn.typeahead,e="ttTypeahead",n={initialize:function(t,n){function i(){var i,r,s=$(this);_.each(n,function(e){e.highlight=!!t.highlight}),r=new Typeahead({input:s,eventBus:i=new EventBus({el:s}),withHint:_.isUndefined(t.hint)?!0:!!t.hint,minLength:t.minLength,autoselect:t.autoselect,datasets:n}),s.data(e,r)}return n=_.isArray(n)?n:[].slice.call(arguments,1),t=t||{},this.each(i)},open:function(){function t(){var t,n=$(this);(t=n.data(e))&&t.open()}return this.each(t)},close:function(){function t(){var t,n=$(this);(t=n.data(e))&&t.close()}return this.each(t)},val:function(t){function n(){var n,i=$(this);(n=i.data(e))&&n.setVal(t)}function i(t){var n,i;return(n=t.data(e))&&(i=n.getVal()),i}return arguments.length?this.each(n):i(this.first())},destroy:function(){function t(){var t,n=$(this);(t=n.data(e))&&(t.destroy(),n.removeData(e))}return this.each(t)}},$.fn.typeahead=function(t){return n[t]?n[t].apply(this,[].slice.call(arguments,1)):n.initialize.apply(this,arguments)},$.fn.typeahead.noConflict=function(){return $.fn.typeahead=t,this}}()}();